"""
Extensions optionnelles :
- SQLAlchemy
- JWT
- Oracle thick (python-oracledb)
Tout est encapsulé pour NE PAS bloquer le démarrage si absent/mal config.
"""

import os

# SQLAlchemy (optionnel)
try:
    from flask_sqlalchemy import SQLAlchemy
    db = SQLAlchemy()
except Exception:
    db = None

# JWT (optionnel)
try:
    from flask_jwt_extended import JWTManager
    jwt = JWTManager()
except Exception:
    jwt = None

# Oracle thick (optionnel)
def init_oracle_client_if_configured(app):
    """
    Active python-oracledb en mode THICK si demandé (ORACLE_THICK_MODE=true).
    Sans exception bloquante.
    """
    try:
        use_thick = os.getenv("ORACLE_THICK_MODE", "false").lower() == "true"
        if not use_thick:
            app.logger.info("Oracle thick désactivé (ORACLE_THICK_MODE=false).")
            return

        import oracledb
        lib_dir = os.getenv("ORACLE_HOME")
        cfg_dir = os.getenv("ORACLE_CONFIG_DIR")
        if lib_dir:
            oracledb.init_oracle_client(lib_dir=lib_dir, config_dir=cfg_dir)
            app.logger.info("Oracle client initialisé en mode THICK (lib_dir=%s).", lib_dir)
        else:
            app.logger.warning("ORACLE_HOME non défini: thick non initialisé.")
    except Exception as exc:
        app.logger.warning("Oracle init skip/fail (non bloquant): %s", exc)
