##############################################
# AttachmentIntegratorApi - .env (Production)
# Fichier ma√Ætre : toutes les variables sont d√©finies ici
# Aucune variable ne doit √™tre d√©clar√©e ailleurs
##############################################

########## IDENTIT√â & CHEMINS ##########
export API_NAME="AttachmentIntegratorApi"
export CONTINUITY="/srv/FircoContinuity"
export API_REPO="${CONTINUITY}/data/new/${API_NAME}"

export API_BIN="${API_REPO}/bin"
export API_CONF="${API_REPO}/conf"
export API_RUN="${API_REPO}/run"
export API_VENV="${API_REPO}/virtual"
export API_LOG="${API_REPO}/log"
export API_CERTIFICATS="${API_REPO}/certificats"
export API_WORK="${API_REPO}/work"
export API_TMP="${API_REPO}/work/tmp"
export API_BUFFER="${API_REPO}/work/tmp"
# Dossiers d√©di√©s aux flux de fichiers
export API_UPLOADS="${API_WORK}/uploads"
export API_DOWNLOADS="${API_WORK}/downloads"

########## GUNICORN / R√âSEAU ##########
export API_HOST="127.0.0.1"
export API_PORT="8410"
export API_NB_WORKERS="2"
export API_NB_THREADS="1"
export API_TIMEOUT="120"
export API_GRACEFUL_TIMEOUT="30"
export API_KEEPALIVE="5"
export API_MAX_REQUESTS="1000"
export API_MAX_REQUESTS_JITTER="50"
export API_WORKER_CLASS="sync"

# Mode socket UNIX (facultatif)
export USE_UNIX_SOCKET="false"
export API_SOCK="${API_RUN}/gunicorn.sock"

########## LOCALES / PYTHON ##########
export PYTHONIOENCODING="utf8"
export LANG="en_US.UTF-8"
# ‚öôÔ∏è Garantit un environnement coh√©rent (UTF-8) pour Python, Oracle et les logs

########## FLASK / JWT ##########
export FLASK_ENV="production"
export SECRET_KEY="change-me"
export JWT_SECRET_KEY="change-me-too"
export JWT_EXPIRES_MIN="60"  # Dur√©e d‚Äôexpiration du token JWT (en minutes)

########## BASE DE DONN√âES (ORACLE) ##########
# ---------------------------------------------------------------
# üî∑ MODE SQLALCHEMY (ORM)
#   - Recommand√© pour la gestion d'entit√©s et transactions automatiques
#   - Utilise SQLAlchemy via le driver oracledb
# ---------------------------------------------------------------
export USE_SQLALCHEMY="true"

# Cha√Æne de connexion Oracle compl√®te (user/pass/host/port/service)
export DATABASE_URL="oracle+oracledb://JJZAO:CHANGE_ME@sldcfrnxjfs2489.fr.intranet:10195/?service_name=ODNX0JZ00"

# ---------------------------------------------------------------
# üî∂ MODE ORACLE THICK (Requ√™tes natives sans ORM)
#   - Si USE_SQLALCHEMY=false, utilisation du client natif Oracle
#   - Oracle Instant Client doit √™tre install√©
# ---------------------------------------------------------------
export ORACLE_THICK_MODE="true"
export ORACLE_CLIENT_LIB_DIR="/opt/oracle/instantclient_19_23"
export ORACLE_CONFIG_DIR="/opt/oracle/network/admin"

# Taille du pool de connexions (ORM)
export DB_NB_POOL="2"

########## S3 (Upload / S√©curit√©) ##########
# ---------------------------------------------------------------
# ‚öôÔ∏è Param√®tres essentiels
# ---------------------------------------------------------------
export S3_ENDPOINT_URL="https://s3.eu-west-3.amazonaws.com"
export AWS_ACCESS_KEY_ID=""
export AWS_SECRET_ACCESS_KEY=""
export S3_BUCKET="cops-bucket"
export S3_KEY_PREFIX="env/prod"
export S3_CA_BUNDLE="${API_CERTIFICATS}/ca.pem"

# ---------------------------------------------------------------
# üîê Param√®tres avanc√©s (d√©sactiv√©s pour le moment)
# ---------------------------------------------------------------
# export S3_REGION_NAME="eu-west-3"
# export S3_ADDRESSING_STYLE="virtual"   # virtual | path
# export S3_SSE="AES256"                 # AES256 | aws:kms
# export S3_SSE_KMS_KEY_ID=""            # ARN de la cl√© KMS si aws:kms
# export S3_CLIENT_CERT="${API_CERTIFICATS}/client.crt"
# export S3_CLIENT_KEY="${API_CERTIFICATS}/client.key"

########## FICHIERS & UPLOAD ##########
export FILENAME_REGEX="^[a-zA-Z0-9._\\- ]+$"
export ALLOWED_EXTENSIONS="doc,docx,eml,gif,html,jpeg,jpg,msg,pdf,png,ppt,pptx,rtf,txt,xls,xlsx,zip,7z"
export MAX_FILE_SIZE="20000000"  # 20 Mo

########## OP√âRATEURS M√âTIER ##########
export VESPER_API_OPERATOR="Vesper Api"
export VESPER_COMMENT="File received from VESPER"
export FLORA_API_OPERATOR="Flora Api"
export FLORA_COMMENT="File received from FLORA"

########## LOGGING ##########
export LOG_LEVEL="INFO"
export LOG_MAX_SIZE="1000000"   # 1 Mo par fichier log avant rotation
export LOG_NB_BACKUP="10"       # Nombre de fichiers log conserv√©s
